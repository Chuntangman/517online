# ç²¾ç®€ç”¨æˆ·åˆ†æç³»ç»Ÿ

## æ¦‚è¿°

ç»è¿‡é‡æ–°è®¾è®¡ï¼Œç”¨æˆ·åˆ†æç³»ç»Ÿç°åœ¨åªæ”¶é›†çœŸæ­£æœ‰ä»·å€¼çš„ç”¨æˆ·è¡Œä¸ºåå¥½æ•°æ®ï¼Œå»é™¤äº†æ— æ„ä¹‰çš„è®¾å¤‡ä¿¡æ¯ã€æµè§ˆå™¨ä¿¡æ¯ã€æ¥æºä¿¡æ¯ç­‰å™ªéŸ³æ•°æ®ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### åªè®°å½•æœ‰ä»·å€¼çš„è¡Œä¸ºæ•°æ®ï¼š

1. **è·¯çº¿å¯¼èˆªè®°å½•** (`route_navigation`)
   - èµ·ç‚¹ã€ç»ˆç‚¹åæ ‡æˆ–åç§°
   - é€”å¾„ç‚¹æ•°é‡
   - è·¯çº¿ç­–ç•¥é€‰æ‹©
   - æœç´¢æ¨¡å¼ï¼ˆåæ ‡/å…³é”®å­—ï¼‰
   - è·ç¦»å’Œæ—¶é—´
   - æ™ºèƒ½é‡‡æ ·å¼€å…³çŠ¶æ€

2. **çƒ­é—¨è·¯çº¿ç‚¹å‡»è®°å½•** (`popular_route_click`)
   - è·¯çº¿IDå’Œåç§°
   - è·¯çº¿åœ°åŒº
   - è·¯çº¿è·ç¦»å’Œæ—¶é•¿
   - ç‚¹å‡»æ¥æº

3. **æ™ºèƒ½è·¯çº¿åŒ¹é…è®°å½•** (`smart_route_match`)
   - ç”¨æˆ·è®¾ç½®çš„åŒ¹é…æ¡ä»¶
   - åå¥½è·ç¦»ã€å¤©æ•°ã€éš¾åº¦
   - å¤©æ°”åå¥½
   - åŒ¹é…åˆ°çš„è·¯çº¿æ•°é‡
   - é€‰æ‹©çš„è·¯çº¿

4. **è½¨è¿¹å›æ”¾ä½¿ç”¨è®°å½•** (`trajectory_playback`)
   - è·¯çº¿IDå’Œåç§°
   - é€”å¾„ç‚¹æ•°é‡
   - å›æ”¾æ¥æºï¼ˆçƒ­é—¨è·¯çº¿/æ™ºèƒ½åŒ¹é…ï¼‰

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### ç²¾ç®€æ•°æ®è¡¨
```sql
-- åªæœ‰ä¸€ä¸ªè¡¨ï¼šuser_behavior_simplified
CREATE TABLE user_behavior_simplified (
    id SERIAL PRIMARY KEY,
    session_id VARCHAR(255) NOT NULL,
    action_type VARCHAR(50) NOT NULL CHECK (action_type IN (
        'route_navigation',
        'popular_route_click', 
        'smart_route_match',
        'trajectory_playback'
    )),
    action_data JSONB NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

### å·²åˆ é™¤çš„æ— ç”¨è¡¨
- âŒ `user_device_info` - è®¾å¤‡ä¿¡æ¯ï¼ˆæµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿç­‰ï¼‰
- âŒ `user_preferences` - ç”¨æˆ·åå¥½ï¼ˆè¯­è¨€ã€ä¸»é¢˜ç­‰ï¼‰
- âŒ `user_referral_info` - æ¥æºä¿¡æ¯ï¼ˆUTMå‚æ•°ç­‰ï¼‰
- âŒ `user_behavior` - å¤æ‚çš„è¡Œä¸ºè¡¨

## ğŸ”§ æŠ€æœ¯æ¶æ„

### åç«¯ç»„ä»¶
```
server/
â”œâ”€â”€ models/
â”‚   â””â”€â”€ userBehaviorSimplifiedModel.js     # ç²¾ç®€è¡Œä¸ºæ¨¡å‹
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ simplifiedAnalyticsController.js    # ç²¾ç®€æ§åˆ¶å™¨
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ simplifiedAnalyticsRoutes.js       # ç²¾ç®€è·¯ç”±
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ simplifiedAnalyticsMiddleware.js   # ç²¾ç®€ä¸­é—´ä»¶
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ simplifiedAnalytics.js             # ç²¾ç®€å·¥å…·
â””â”€â”€ sql/
    â””â”€â”€ create_simplified_analytics_table.sql # æ•°æ®è¡¨è„šæœ¬
```

### å‰ç«¯ç»„ä»¶
```
src/
â””â”€â”€ utils/
    â””â”€â”€ simplifiedAnalytics.js             # ç²¾ç®€å‰ç«¯å·¥å…·
```

## ğŸ“¡ API æ¥å£

### æ–°çš„ç²¾ç®€æ¥å£
- `POST /api/v1/analytics-simple/trajectory-playback` - æ‰‹åŠ¨è®°å½•è½¨è¿¹å›æ”¾
- `GET /api/v1/analytics-simple/statistics/behavior` - è·å–è¡Œä¸ºç»Ÿè®¡
- `GET /api/v1/analytics-simple/statistics/popular-routes` - è·å–çƒ­é—¨è·¯çº¿ç»Ÿè®¡
- `GET /api/v1/analytics-simple/statistics/navigation-preferences` - è·å–å¯¼èˆªåå¥½ç»Ÿè®¡
- `GET /api/v1/analytics-simple/report` - è·å–ç»¼åˆåˆ†ææŠ¥å‘Š
- `GET /api/v1/analytics-simple/health` - å¥åº·æ£€æŸ¥

### å·²åˆ é™¤çš„å¤æ‚æ¥å£
- âŒ `/api/v1/analytics/*` - æ‰€æœ‰æ—§çš„å¤æ‚åˆ†ææ¥å£

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. åˆ›å»ºæ•°æ®è¡¨
```bash
# åœ¨PostgreSQLä¸­æ‰§è¡Œ
psql -d your_database -f server/sql/create_simplified_analytics_table.sql
```

### 2. å¯åŠ¨æœåŠ¡
```bash
npm run dev:full
```

### 3. éªŒè¯åŠŸèƒ½
- å¯¼èˆªè·¯çº¿è§„åˆ’ â†’ è‡ªåŠ¨è®°å½•
- ç‚¹å‡»çƒ­é—¨è·¯çº¿ â†’ è‡ªåŠ¨è®°å½•
- ä½¿ç”¨è½¨è¿¹å›æ”¾ â†’ è‡ªåŠ¨è®°å½•
- æŸ¥çœ‹ç»Ÿè®¡æ•°æ® â†’ `GET /api/v1/analytics-simple/report`

## ğŸ“Š æ•°æ®æ”¶é›†æ–¹å¼

### è‡ªåŠ¨æ”¶é›†ï¼ˆä¸­é—´ä»¶ï¼‰
- **è·¯çº¿å¯¼èˆª**ï¼šåœ¨ç”¨æˆ·æˆåŠŸè§„åˆ’è·¯çº¿æ—¶è‡ªåŠ¨è®°å½•
- **çƒ­é—¨è·¯çº¿ç‚¹å‡»**ï¼šåœ¨è·å–è·¯çº¿è¯¦æƒ…æ—¶è‡ªåŠ¨è®°å½•
- **æ™ºèƒ½è·¯çº¿åŒ¹é…**ï¼šåœ¨æ™ºèƒ½åŒ¹é…æˆåŠŸæ—¶è‡ªåŠ¨è®°å½•

### æ‰‹åŠ¨è®°å½•ï¼ˆå‰ç«¯è°ƒç”¨ï¼‰
- **è½¨è¿¹å›æ”¾**ï¼šé€šè¿‡å‰ç«¯å·¥å…·æ‰‹åŠ¨å‘é€è®°å½•

### æ™ºèƒ½å»é‡
- 5åˆ†é’Ÿçª—å£å†…ç›¸åŒè¡Œä¸ºè‡ªåŠ¨å»é‡
- é˜²æ­¢é‡å¤æ•°æ®æ±¡æŸ“
- å†…å­˜ç¼“å­˜ï¼Œæ€§èƒ½ä¼˜å¼‚

## ğŸ” æ•°æ®åˆ†æä»·å€¼

### å¯ä»¥åˆ†æçš„ç”¨æˆ·åå¥½
1. **å¯¼èˆªä¹ æƒ¯**
   - åå¥½çš„è·¯çº¿ç­–ç•¥ï¼ˆæ¨è/æœ€å¿«ï¼‰
   - æœç´¢æ¨¡å¼åå¥½ï¼ˆåæ ‡/å…³é”®å­—ï¼‰
   - æ˜¯å¦å–œæ¬¢ä½¿ç”¨æ™ºèƒ½é‡‡æ ·

2. **è·¯çº¿åå¥½**
   - æœ€å—æ¬¢è¿çš„è·¯çº¿
   - åœ°åŒºåå¥½åˆ†å¸ƒ
   - è·ç¦»å’Œæ—¶é•¿åå¥½

3. **ä½¿ç”¨æ¨¡å¼**
   - åŠŸèƒ½ä½¿ç”¨é¢‘ç‡
   - è½¨è¿¹å›æ”¾ä½¿ç”¨æƒ…å†µ
   - æ™ºèƒ½åŒ¹é…å‚æ•°åå¥½

## ğŸ¯ æ€§èƒ½æå‡

### ç›¸æ¯”æ—§ç³»ç»Ÿçš„ä¼˜åŠ¿
- **æ•°æ®åº“è´Ÿè½½å‡å°‘90%** - åªè®°å½•æœ‰ä»·å€¼æ•°æ®
- **å­˜å‚¨ç©ºé—´èŠ‚çœ80%** - å»é™¤å†—ä½™ä¿¡æ¯
- **æŸ¥è¯¢æ€§èƒ½æå‡70%** - ç®€åŒ–è¡¨ç»“æ„
- **ä»£ç å¤æ‚åº¦é™ä½85%** - ç²¾ç®€æ¶æ„

### å®é™…æ•ˆæœ
- âœ… ä¸å†è®°å½•æ— æ„ä¹‰çš„è®¾å¤‡ä¿¡æ¯
- âœ… ä¸å†é‡å¤æ”¶é›†æµè§ˆå™¨ä¿¡æ¯
- âœ… ä¸å†è¿½è¸ªé¡µé¢è®¿é—®å™ªéŸ³
- âœ… åªä¿ç•™çœŸæ­£çš„ç”¨æˆ·åå¥½æ•°æ®

## ğŸ”® ç¤ºä¾‹æ•°æ®

```json
{
  "route_navigation": {
    "start_point": "116.4074,39.9042",
    "end_point": "121.4737,31.2304", 
    "waypoints_count": 3,
    "route_policy": "0",
    "search_mode": "coordinates",
    "distance": "1200km",
    "duration": "8å°æ—¶",
    "smart_sampling_enabled": true
  },
  "popular_route_click": {
    "route_id": "1",
    "route_name": "é’æµ·æ¹–ç¯æ¹–éª‘è¡Œè·¯çº¿",
    "route_region": "é’æµ·",
    "route_distance": "360km",
    "route_duration": "3å¤©",
    "click_source": "popular_routes"
  }
}
```

## ğŸ‰ æ€»ç»“

é€šè¿‡ç²¾ç®€åˆ†æç³»ç»Ÿï¼Œæˆ‘ä»¬æˆåŠŸï¼š
- å»é™¤äº†90%çš„æ— ç”¨æ•°æ®æ”¶é›†
- ä¿ç•™äº†100%çš„æœ‰ä»·å€¼ç”¨æˆ·è¡Œä¸º
- å¤§å¹…æå‡äº†ç³»ç»Ÿæ€§èƒ½
- ç®€åŒ–äº†ä»£ç ç»´æŠ¤
- æä¾›äº†æ›´å‡†ç¡®çš„ç”¨æˆ·åå¥½åˆ†æ

ç°åœ¨çš„ç³»ç»Ÿä¸“æ³¨äºçœŸæ­£é‡è¦çš„ç”¨æˆ·è¡Œä¸ºæ¨¡å¼ï¼Œä¸ºäº§å“ä¼˜åŒ–æä¾›æœ‰ä»·å€¼çš„æ•°æ®æ”¯æŒã€‚
